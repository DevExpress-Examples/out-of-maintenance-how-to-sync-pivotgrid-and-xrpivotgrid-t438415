@Html.DevExpress().PivotGrid(settings => {
    settings.Name = "PivotGrid";
    settings.CallbackRouteValues = new { Controller = "Home", Action = "PivotGridPartial" };
    settings.OptionsData.DataProcessingEngine = PivotDataProcessingEngine.Optimized;
    settings.Fields.Add(field => {
        field.Area = PivotArea.RowArea;
        field.DataBinding = new DevExpress.Web.ASPxPivotGrid.DataSourceColumnBinding("CategoryName");
        field.Caption = "CategoryName";
    });
    settings.Fields.Add(field => {
        field.Area = PivotArea.FilterArea;
        field.DataBinding = new DevExpress.Web.ASPxPivotGrid.DataSourceColumnBinding("ProductName");
        field.Caption = "ProductName";
    });
    settings.Fields.Add(field => {
        field.Area = PivotArea.DataArea;
        field.DataBinding = new DevExpress.Web.ASPxPivotGrid.DataSourceColumnBinding("ProductSales");
        field.Caption = "ProductSales";
    });
    settings.Fields.Add(field => {
        field.Area = PivotArea.FilterArea;
        field.DataBinding = new DevExpress.Web.ASPxPivotGrid.DataSourceColumnBinding("ShippedDate");
        field.Caption = "ShippedDate";
    });

    settings.PreRender = settings.AfterPerformCallback = (s, e) => {
        MVCxPivotGrid pivot = (MVCxPivotGrid)s;
        using (MemoryStream collapsedStateMS = new MemoryStream())
        using (MemoryStream layoutMS = new MemoryStream()) {
            new DevExpress.Utils.Serializing.XmlXtraSerializer().SerializeObject(pivot, layoutMS, "PivotGrid");
            pivot.SaveCollapsedStateToStream(collapsedStateMS);

            Session["CollapsedState"] = collapsedStateMS.ToArray();
            Session["Layout"] = layoutMS.ToArray();
        }
    };
    settings.ClientSideEvents.Init = "onInit";
    settings.ClientSideEvents.EndCallback = "onEndCallback";
}).Bind(Model).GetHtml()